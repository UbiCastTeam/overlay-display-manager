function OverlayDisplayManager(e){const t=["id","language","defaultButtonsClass","overlaySelectorPlace","hideOnEscape","margin","elementPadding","topBarHeight","bottomBarHeight","zIndex"];if(this.id=1,this.language="en",this.defaultButtonsClass="",this.overlaySelectorPlace="body",this.hideOnEscape=!0,this.margin=2,this.elementPadding=1,this.topBarHeight=1.75,this.bottomBarHeight=2,this.zIndex=null,this.pendingShowParams=null,this.messages={},this.widget=null,this.maxWidth=0,this.maxHeight=0,this.image=null,this.elementPlace=null,this.displayed=!1,this.displayedElement=null,this.elementPaddingDisplayed=!1,this.topBarDisplayed=!1,this.bottomBarDisplayed=!1,this.displayMode=null,this.title="",this.resources=[],this.currentIndex=0,this.currentResource=null,this.locked=!1,this.noFixed=!1,this.elementFirstFocused=null,this.lastFocus=null,this.ignoreUntilFocusChanges=!1,window.jsu&&(this.language=window.jsu.getCurrentLang()),e){let i;for(i in e)t.indexOf(i)<0?console.error("Unknown attribute given to OverlayDisplayManager: "+i):this[i]=e[i]}this.setLanguage(this.language),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(this._init.bind(this),1):document.addEventListener("DOMContentLoaded",this._init.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}OverlayDisplayManager.version=3,OverlayDisplayManager.prototype._init=function(){isNaN(this.id)||(window.odmIdCount?(window.odmIdCount++,this.id=window.odmIdCount):(window.odmIdCount=1,this.id=1));let e=[];"body"==this.overlaySelectorPlace&&"iPad"!=navigator.platform&&"iPhone"!=navigator.platform&&"iPod"!=navigator.platform||(this.noFixed=!0,e.push("no-fixed")),window.odmConf&&window.odmConf.extraCssClasses&&(e=e.concat(window.odmConf.extraCssClasses)),this.widget=document.createElement("div"),this.widget.setAttribute("id","odm_"+this.id),this.widget.setAttribute("class","odm-main "+e.join(" ")),this.zIndex&&this.widget.setAttribute("style","z-index:"+this.zIndex),this.widget.innerHTML='<div class="odm-layer" tabindex="0"><table class="odm-table" role="presentation"><tr class="odm-table"><td class="odm-table"><div role="dialog" tabindex="-1" aria-labelledby="odm_title_'+this.id+'" aria-modal="true" class="odm-block"><button type="button" class="odm-close" title="'+this.messages.close+'" aria-label="'+this.messages.close+'"><i aria-hidden="true">X</i></button><div class="odm-top-bar"><div class="odm-resources"></div><h1 id="odm_title_'+this.id+'" class="odm-title"></h1></div><div class="odm-element-place"><div class="odm-element-content"></div><div class="odm-hover-loading"><div>'+this.messages.loading+'</div></div></div><div class="odm-bottom-bar"><div class="odm-buttons"></div></div><button type="button" class="odm-previous"><span><i>←</i><b>'+this.messages.previous+'</b></span></button><button type="button" class="odm-next"><span><i>→</i><b>'+this.messages.next+'</b></span></button></div></td></tr></table></div><div class="odm-closer" tabindex="0"></div>',document.querySelector(this.overlaySelectorPlace).appendChild(this.widget),this.elementPlace=this.widget.querySelector(".odm-element-content");const t=this;this.widget.querySelector(".odm-previous").addEventListener("click",function(){t.previous()}),this.widget.querySelector(".odm-next").addEventListener("click",function(){t.next()}),this.widget.querySelector(".odm-close").addEventListener("click",function(){t.locked||t.hide()}),this.widget.querySelector(".odm-closer").addEventListener("click",function(){t.locked||t.hide()}),this.widget.querySelector(".odm-element-content").addEventListener("click",function(){!t.locked&&"image"==t.displayMode&&t.resources.length<2&&t.image&&!t.image.loadingFailed&&t.hide()}),window.addEventListener("keydown",function(e){if(t.displayed)switch(e.key){case"Escape":!t.locked&&t.hideOnEscape&&(e.stopImmediatePropagation(),t.hide());break;case"ArrowLeft":e.stopImmediatePropagation(),t.previous();break;case"ArrowRight":e.stopImmediatePropagation(),t.next()}}),this.onResize(),this.pendingShowParams&&this.show(this.pendingShowParams)},OverlayDisplayManager.prototype.trapFocus=function(e){this.ignoreUntilFocusChanges||(this.widget.querySelector(".odm-block").contains(e.target)?this.lastFocus=e.target:(this.focusFirstDescendant(this.widget.querySelector(".odm-block")),this.lastFocus==document.activeElement&&this.focusLastDescendant(this.widget.querySelector(".odm-block")),this.lastFocus=document.activeElement))},OverlayDisplayManager.prototype.focusLastDescendant=function(e){for(let t=e.childNodes.length-1;t>=0;t--){const i=e.childNodes[t];if(this.attemptFocus(i)||this.focusLastDescendant(i))return!0}return!1},OverlayDisplayManager.prototype.focusFirstDescendant=function(e){for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if(this.attemptFocus(i)||this.focusFirstDescendant(i))return!0}return!1},OverlayDisplayManager.prototype.attemptFocus=function(e){if(!this.isFocusable(e))return!1;this.ignoreUntilFocusChanges=!0;try{e.focus()}catch(e){console.error("Failed to focus last element.",e)}return this.ignoreUntilFocusChanges=!1,document.activeElement===e},OverlayDisplayManager.prototype.isFocusable=function(e){if(e.tabIndex>0||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!=e.rel;case"INPUT":return"hidden"!=e.type&&"file"!=e.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},OverlayDisplayManager.prototype.setLanguage=function(e){"fr"==e?(this.language="fr",this.messages={close:"Fermer",loading:"Chargement...",notFound:"Image introuvable",unknownResource:"Type de ressource inconnu",previous:"Pr&eacute;c&eacute;dent",next:"Suivant"}):(this.language="en",this.messages={close:"Close",loading:"Loading...",notFound:"Image not found",unknownResource:"Unknown resource type",previous:"Previous",next:"Next"}),this.widget&&(this.widget.querySelector(".odm-close").setAttribute("title",this.messages.close),this.widget.querySelector(".odm-close").setAttribute("aria-label",this.messages.close),this.widget.querySelector(".odm-hover-loading div").innerHTML=this.messages.loading,this.widget.querySelector(".odm-previous b").innerHTML=this.messages.previous,this.widget.querySelector(".odm-next b").innerHTML=this.messages.next)},OverlayDisplayManager.prototype.onResize=function(){let e;this.displayedElement&&this.displayedElement.parentElement==this.elementPlace&&(e=this.displayedElement);let t=15;if(e)try{const i=window.getComputedStyle(e).getPropertyValue("fontSize");i.indexOf("px")>0&&(t=parseFloat(i.replace(/[^0-9.]+/g,"")))}catch(e){}const i=this.margin;let s=this.margin;if(this.topBarDisplayed&&(s+=this.topBarHeight),this.bottomBarDisplayed&&(s+=this.bottomBarHeight),"body"!=this.overlaySelectorPlace){const e=document.querySelector(this.overlaySelectorPlace);this.maxWidth=e.offsetWidth-i*t,this.maxHeight=e.offsetHeight-s*t}else this.maxWidth=window.innerWidth-i*t,this.maxHeight=window.innerHeight-s*t;const o=this.elementPaddingDisplayed?this.elementPadding*t:0;e&&(this.maxWidth>0&&e.style.setProperty("max-width",this.maxWidth-o+"px"),this.maxHeight>0&&e.style.setProperty("max-height",this.maxHeight-o+"px"))},OverlayDisplayManager.prototype._setResources=function(e){if(this.widget&&!this.displayed){this.loadingDisplayed=!0;const e=document.createElement("div");e.setAttribute("class","odm-element odm-loading"),e.innerHTML=this.messages.loading,this._displayElement(e),this.image=null,this.currentResource=null}if(this.resources=[],"string"!=typeof e&&void 0!==e.length)for(let t=0;t<e.length;t++)this._addResources(e[t]);else this._addResources(e);if(this.currentIndex=0,!(this.resources.length<1))return this.resources.length>1?(e.index&&e.index>0&&e.index<e.length&&(this.currentIndex=e.index),this.widget&&(this.widget.querySelector(".odm-resources").innerHTML=this.currentIndex+1+" / "+this.resources.length,this.topBarDisplayed||(this.topBarDisplayed=!0,this.widget.classList.add("odm-top-bar-displayed"),this.onResize()),this.currentIndex>0?this.widget.querySelector(".odm-previous").style.setProperty("display","block"):this.widget.querySelector(".odm-previous").style.setProperty("display","none"),this.currentIndex<this.resources.length-1?this.widget.querySelector(".odm-next").style.setProperty("display","block"):this.widget.querySelector(".odm-next").style.setProperty("display","none"))):this.widget&&(this.topBarDisplayed&&!this.title&&(this.topBarDisplayed=!1,this.widget.classList.remove("odm-top-bar-displayed"),this.onResize()),this.widget.querySelector(".odm-resources").innerHTML="",this.widget.querySelector(".odm-previous").style.setProperty("display","none"),this.widget.querySelector(".odm-next").style.setProperty("display","none")),this.resources[this.currentIndex]},OverlayDisplayManager.prototype._addResources=function(e){"string"==typeof e?this.resources.push({image:e}):this.resources.push(e)},OverlayDisplayManager.prototype._checkTitleDisplay=function(e){if(this.title==e)return;this.widget.querySelector(".odm-title").textContent=e,this.title=e;const t=e||this.resources.length>1;t&&!this.topBarDisplayed?(this.topBarDisplayed=!0,this.widget.classList.add("odm-top-bar-displayed"),this.onResize()):!t&&this.topBarDisplayed&&(this.topBarDisplayed=!1,this.widget.classList.remove("odm-top-bar-displayed"),this.onResize())},OverlayDisplayManager.prototype._checkButtonsDisplay=function(e){const t=e.buttons;if(t){if(!t.loaded){this.widget.querySelector(".odm-buttons").innerHTML="";for(let e=0;e<t.length;e++){const i=document.createElement("button");if(i.setAttribute("type","button"),i.innerHTML=t[e].label,t[e].id&&i.setAttribute("id",t[e].id),t[e].disabled&&i.setAttribute("disabled","disabled"),t[e].klass?i.setAttribute("class",this.defaultButtonsClass+" "+t[e].klass):i.setAttribute("class",this.defaultButtonsClass),t[e].callback){const s=t[e].callback,o=t[e].data?t[e].data:{};o.odm=this,i.addEventListener("click",function(e){s(e,o)})}t[e].close&&i.addEventListener("click",this.hide.bind(this)),this.widget.querySelector(".odm-buttons").appendChild(i)}t.loaded=!0}this.bottomBarDisplayed||(this.widget.classList.add("odm-bottom-bar-displayed"),this.bottomBarDisplayed=!0,this.onResize()),this.focusFirstDescendant(this.widget.querySelector(".odm-element-content"))||this.focusFirstDescendant(this.widget.querySelector(".odm-block"))}else this.bottomBarDisplayed&&(this.widget.classList.remove("odm-bottom-bar-displayed"),this.bottomBarDisplayed=!1,this.widget.querySelector(".odm-buttons").innerHTML="",this.onResize())},OverlayDisplayManager.prototype._setLocked=function(e){if(this.locked==e)return;this.locked=e;const t=this.locked?"none":"";this.widget.querySelector(".odm-close").style.setProperty("display",t)},OverlayDisplayManager.prototype._onResourceHide=function(){this.currentResource&&this.currentResource.onHide&&(this.currentResource.onHide(),delete this.currentResource.onHide)},OverlayDisplayManager.prototype._loadResource=function(e){this._onResourceHide(),this._checkTitleDisplay(e.title?e.title:""),this._checkButtonsDisplay(e),this._setLocked(Boolean(e.locked)),this.currentResource=e,e.image?this._loadImage(e):e.iframe?this._loadIframe(e):e.html?this._loadHTML(e):this._displayError("unknownResource")},OverlayDisplayManager.prototype.change=function(e){if(!e)return;const t=this._setResources(e);this.displayed&&this._loadResource(t)},OverlayDisplayManager.prototype.show=function(e){if(!this.widget)return void(this.pendingShowParams=e);if(this.pendingShowParams=null,this.displayed)return this.change(e);let t;if(this.elementFirstFocused=document.activeElement,e)t=this._setResources(e);else{if(this.resources.length<1)return;this.currentResource||(t=this.resources[this.currentIndex])}if(t?this._loadResource(t):this._refreshElement(),this.noFixed)if("body"!=this.overlaySelectorPlace)this.widget.querySelector(".odm-table").style.setProperty("margin-top","10px");else{const e=void 0!==window.scrollY?window.scrollY:0;this.widget.querySelector(".odm-table").style.setProperty("margin-top",e+10+"px")}this.displayed=!0,this.widget.style.setProperty("opacity","0"),this.widget.style.setProperty("display","block"),this.widget.style.setProperty("opacity","");const i=this;setTimeout(function(){i.lastFocus=document.activeElement,i.widget.addEventListener("focus",i.trapFocus.bind(i),!0),i.focusFirstDescendant(i.widget.querySelector(".odm-element-content"))||i.focusFirstDescendant(i.widget.querySelector(".odm-block"))},300)},OverlayDisplayManager.prototype.hide=function(){if(this.pendingShowParams&&(this.pendingShowParams=null),!this.displayed)return;this.displayed=!1,this.widget.style.setProperty("opacity","0");const e=this;setTimeout(function(){e.displayed||(e.widget.style.setProperty("display",""),e._onResourceHide(),e.elementFirstFocused&&e.attemptFocus(e.elementFirstFocused),e.widget.removeEventListener("focus",e.trapFocus,!0),e.lastFocus=document.activeElement)},300)},OverlayDisplayManager.prototype.goToIndex=function(e){e>=this.resources.length||e<0||(this.widget.querySelector(".odm-resources").innerHTML=e+1+" / "+this.resources.length,e>0?this.widget.querySelector(".odm-previous").style.setProperty("display","block"):this.widget.querySelector(".odm-previous").style.setProperty("display",""),e<this.resources.length-1?this.widget.querySelector(".odm-next").style.setProperty("display","block"):this.widget.querySelector(".odm-next").style.setProperty("display",""),this.currentIndex!=e&&(this.currentIndex=e,this._loadResource(this.resources[this.currentIndex])))},OverlayDisplayManager.prototype.next=function(){this.resources.length>0&&this.currentIndex+1<this.resources.length&&this.goToIndex(this.currentIndex+1)},OverlayDisplayManager.prototype.previous=function(){this.resources.length>0&&this.currentIndex-1>=0&&this.goToIndex(this.currentIndex-1)},OverlayDisplayManager.prototype._displayElement=function(e,t){const i=this.elementPlace;if(this.displayedElement&&this.displayedElement!=e){const e=this.displayedElement,t=function(){e.parentElement==i&&e.parentElement.removeChild(e),e.style.setProperty("opacity",""),e.style.setProperty("position",""),e.classList.remove("odm-element")};!this.displayed||e.classList.contains("odm-loading")||e.classList.contains("odm-error")?t():(e.style.setProperty("opacity","0"),e.style.setProperty("position","absolute"),setTimeout(t,300))}this.elementPaddingDisplayed=Boolean(t),this.displayedElement=e,e&&e.parentElement!=i&&i.appendChild(e)},OverlayDisplayManager.prototype._refreshElement=function(){this._displayElement(this.displayedElement,this.elementPaddingDisplayed)},OverlayDisplayManager.prototype._displayError=function(e){const t=document.createElement("div");t.innerHTML='<div class="odm-element odm-error">'+(e in this.messages?this.messages[e]:e)+"</div>",this._displayElement(t)},OverlayDisplayManager.prototype._showLoading=function(){if(this.loadingDisplayed)return;this.loadingDisplayed=!0,null!==this.loadingTimeoutId&&(clearTimeout(this.loadingTimeoutId),this.loadingTimeoutId=null);const e=this;this.loadingTimeoutId=setTimeout(function(){e.widget.classList.add("odm-hover-loading-displayed")},300)},OverlayDisplayManager.prototype._hideLoading=function(){this.loadingDisplayed&&(this.loadingDisplayed=!1,null!==this.loadingTimeoutId&&(clearTimeout(this.loadingTimeoutId),this.loadingTimeoutId=null),this.widget.classList.remove("odm-hover-loading-displayed"))},OverlayDisplayManager.prototype._loadImage=function(e,t){if("image"!=this.displayMode){this.displayMode="image",this.loadingDisplayed=!0;const e=document.createElement("div");e.setAttribute("class","odm-element odm-loading"),e.innerHTML=this.messages.loading,this._displayElement(e)}else if(this.image&&this.image.oriSrc==e.image)return void(t&&t(Boolean(this.image.loadingFailed)));this.image=new Image,this.image.odm=this,this.image.odmCallback=t;const i=e.alt||"";this._showLoading(),this.image.onload=function(){const e=document.createElement("img");e.setAttribute("class","odm-element"),e.setAttribute("alt",i),e.setAttribute("src",this.src),e.setAttribute("style","max-width: "+this.odm.maxWidth+"px; max-height: "+this.odm.maxHeight+"px;"),this.odm._hideLoading(),this.odm._displayElement(e),this.odmCallback&&this.odmCallback(!0)},this.image.onabort=this.image.onload,this.image.onerror=function(){this.loadingFailed=!0,this.odm._hideLoading(),this.odm._displayError("notFound"),this.odmCallback&&this.odmCallback(!1)},this.image.oriSrc=e.image,this.image.src=e.image},OverlayDisplayManager.prototype._loadIframe=function(e,t){"iframe"!=this.displayMode&&(this.displayMode="iframe");const i=e.width?e.width:this.maxWidth+"px",s=e.height?e.height:this.maxHeight+"px",o=document.createElement("iframe");o.setAttribute("class","odm-element"),o.setAttribute("src",e.iframe),o.setAttribute("style","width: "+i+"; height: "+s+";"),this._displayElement(o),t&&t(!0)},OverlayDisplayManager.prototype._loadHTML=function(e,t){let i;"html"!=this.displayMode&&(this.displayMode="html"),"string"==typeof e.html?(i=document.createElement("div")).innerHTML=e.html:(i="detach"in e.html?e.html[0]:e.html).parentElement&&i.parentElement.removeChild(i),i.classList.add("odm-element"),i.style.setProperty("max-width",this.maxWidth-this.elementPadding+"px"),i.style.setProperty("max-height",this.maxHeight-this.elementPadding+"px"),i.style.setProperty("opacity",""),i.style.setProperty("position",""),this._displayElement(i,!0),t&&t(!0)};